<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2024-01-23T07:32:04.568549">        <title>SCHEMA_ONLY | hms-mirror</title><script type="application/json" id="virtual-toc-data">[{"id":"options","level":0,"title":"Options","anchor":"#options"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png">  <link rel="manifest" href="site.webmanifest">  <meta name="msapplication-TileColor" content="#000000"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png">  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="SCHEMA_ONLY | hms-mirror"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="hms-mirror Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="hms-mirrorhms-mirror-schema-only.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="SCHEMA_ONLY | hms-mirror"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "WebPage", "@id": "hms-mirrorhms-mirror-schema-only.html#webpage", "url": "hms-mirrorhms-mirror-schema-only.html", "name": "SCHEMA_ONLY | hms-mirror", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{ "@type": "WebSite", "@id": "hms-mirror/#website", "url": "hms-mirror/", "name": "hms-mirror Help" }</script><!-- End Schema.org --></head>      <body data-id="hms-mirror-schema-only" data-main-title="SCHEMA_ONLY" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Strategies.md|Strategies"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>hms-mirror  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="hms-mirror-schema-only"   id="hms-mirror-schema-only.md">SCHEMA_ONLY</h1>  <p id="8f0f359d_236">This strategy is used to migrate &quot;only&quot; the schema (mostly). When migrating from a <code class="code" id="8f0f359d_238">legacy</code> (Hive 1/2) hive environment to a <code class="code" id="8f0f359d_239">non-legacy</code> (Hive 3+) <code class="code" id="8f0f359d_240">hms-mirror</code> will convert tables that are &quot;managed non-transactional&quot; to &quot;external/purge&quot;. This translation is a part of the HSMM (Hive Strict Managed Migration) process that run for 'in-place' upgrades.</p><p id="8f0f359d_241"><code class="code" id="8f0f359d_242">hms-mirror</code> is mostly designed for &quot;side-car&quot; migrations which involves two separate clusters.</p><section class="chapter"><h2 id="options" data-toc="options">Options</h2><section class="chapter"><h3 id="f-flip" data-toc="f-flip">-f|--flip</h3><p id="8f0f359d_243">The configuration yaml has two clusters defined: LEFT and RIGHT. By default, all work moves from LEFT to RIGHT. If you need to perform actions from RIGHT to LEFT, use the <code class="code" id="8f0f359d_244">-f</code> option to switch these clusters. The final report will show that these clusters have been reversed.</p></section><section class="chapter"><h3 id="ma-migrate-acid-or-mao-migrate-acid-only-optional-artificial-bucket-limit-default-is-2" data-toc="ma-migrate-acid-or-mao-migrate-acid-only-optional-artificial-bucket-limit-default-is-2">-ma|--migrate-acid or -mao|--migrate-acid-only`  [optional artificial bucket limit] (default is 2)</h3><p id="8f0f359d_245">The default behaviour is NOT to handle ACID tables. ACID tables require some additional handling. When you need to address ACID tables, use these flags to either include them OR migrate ONLY ACID tables.</p><p id="8f0f359d_246">Migrations from legacy hive environments may have had to create tables with an unnecessary <code class="code" id="8f0f359d_247">CLUSTERED BY</code> clause to support <code class="code" id="8f0f359d_248">bucketing</code> for these ACID tables. The <code class="code" id="8f0f359d_249">artificial bucket limit</code> is an opportunity to remove those definitions for the migrated tables. For example: If you've defined a table with 2 buckets, the default <code class="code" id="8f0f359d_250">artificial bucket limit</code> is 2, so the table <code class="code" id="8f0f359d_251">CLUSTERED BY ... INTO 2 BUCKETS</code> will be removed from the definition.</p></section><section class="chapter"><h3 id="mnno-migrate-non-native-only" data-toc="mnno-migrate-non-native-only">-mnno|--migrate-non-native-only</h3><p id="8f0f359d_252">Use this to migrate <span class="emphasis" id="8f0f359d_253">non-native</span> hive tables like: Kafka, HBase, JDBC Federated, etc.. This option excludes <span class="emphasis" id="8f0f359d_254">native</span> tables from processing, so you should run it separately.</p><p id="8f0f359d_255">Note that many of these tables <span class="control" id="8f0f359d_256">REQUIRE</span> that the supporting references <span class="control" id="8f0f359d_257">EXIST</span> first, or their creation will <span class="control" id="8f0f359d_258">FAIL</span>. For instance, migrating a table with the HBase Storage handler requires that the HBase table is <span class="emphasis" id="8f0f359d_259">present</span> AND <span class="emphasis" id="8f0f359d_260">visible</span> from Hive.</p></section><section class="chapter"><h3 id="v-views-only" data-toc="v-views-only">-v|--views-only</h3><p id="8f0f359d_261">Like <code class="code" id="8f0f359d_262">-mnno</code> the <code class="code" id="8f0f359d_263">-v</code> option excludes other tables from processing, so it's designed to run along. And like the <code class="code" id="8f0f359d_264">-mnno</code> option, it too requires the supporting tables to exist, otherwise the view create statements will <span class="emphasis" id="8f0f359d_265">fail</span>.</p></section><section class="chapter"><h3 id="asm-avro-schema-migration" data-toc="asm-avro-schema-migration">-asm|--avro-schema-migration</h3><p id="8f0f359d_266">AVRO tables have a <code class="code" id="8f0f359d_267">TBLPROPERTIES</code> key <code class="code" id="8f0f359d_268">avro.schema.url</code> that identifies the supporting avro schemas location on the current cluster. When migrating AVRO tables, use this option to check for this setting. As a result, <code class="code" id="8f0f359d_269">hms-mirror</code> will parse out the location and replace it with the same relative location.</p><p id="8f0f359d_270"><code class="code" id="8f0f359d_271">hms-mirror</code> will use the configured environments <code class="code" id="8f0f359d_272">hdfs|core-site.xml</code> files to launch an <code class="code" id="8f0f359d_273">hdfs</code> client that will copy the supporting avro schema between clusters. For this to work, the clusters MUST be <a href="linking-cluster-storage-layers.html" id="8f0f359d_274" data-tooltip="For the hms-mirror process to work, it relies on the RIGHT clusters' ability to SEE and ACCESS data in the LEFT clusters HDFS namespace. This is the same access/configuration required to support DISTCP for an HA environment and accounts for failovers.">visible to each other</a>.</p><p id="8f0f359d_275">The DUMP strategy is like SCHEMA_ONLY; it just doesn't require the RIGHT cluster to be connected. Although, it does need the following settings for the RIGHT cluster to make the proper adjustments:</p><div class="code-block" data-lang="none">
legacyHive
hcfsNamespace
hiveServer2 -&gt; partitionDiscovery 
</div><p id="8f0f359d_277">When the option <code class="code" id="8f0f359d_278">-ma</code> (migrate acid) is specified, the ACID schema's will be migrated/dumped. It is essential to know that the data for ACID tables can NOT simply be copied from one clusters hive instance to another. The data needs to be extracted to a none ACID table, then use an external table definition to read and INSERT the data into the new ACID table on the RIGHT cluster. For those that insist on trying to simply copy the data.... you've been warned ;).</p><p id="8f0f359d_279">With the DUMP strategy, you'll have a 'translated' (for legacy hive) table DDL that can be run on the new cluster independently.</p><figure id="8f0f359d_280"><img alt="schema_only" src="images/schema_only.png" title="schema_only" width="680" height="523"></figure><figure id="8f0f359d_281"><img alt="schema_only_cloud" src="images/schema_only_cloud.png" title="schema_only_cloud" width="680" height="533"></figure></section></section><div class="last-modified">Last modified: 23 January 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"> <a href="strategies.html" class="navigation-links__prev">Strategies</a><a href="dump.html" class="navigation-links__next">DUMP</a> </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>