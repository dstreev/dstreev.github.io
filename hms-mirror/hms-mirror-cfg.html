<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2024-01-23T07:32:04.594592">        <title>Configuration | hms-mirror</title><script type="application/json" id="virtual-toc-data">[{"id":"jdbc-drivers-and-configuration","level":0,"title":"JDBC Drivers and Configuration","anchor":"#jdbc-drivers-and-configuration"},{"id":"secure-passwords-in-configuration","level":0,"title":"Secure Passwords in Configuration","anchor":"#secure-passwords-in-configuration"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png">  <link rel="manifest" href="site.webmanifest">  <meta name="msapplication-TileColor" content="#000000"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png">  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Configuration | hms-mirror"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="hms-mirror Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="hms-mirrorhms-mirror-cfg.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Configuration | hms-mirror"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "WebPage", "@id": "hms-mirrorhms-mirror-cfg.html#webpage", "url": "hms-mirrorhms-mirror-cfg.html", "name": "Configuration | hms-mirror", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{ "@type": "WebSite", "@id": "hms-mirror/#website", "url": "hms-mirror/", "name": "hms-mirror Help" }</script><!-- End Schema.org --></head>      <body data-id="hms-mirror-cfg" data-main-title="Configuration" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs=""  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>hms-mirror  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="hms-mirror-cfg"   id="hms-mirror-cfg.md">Configuration</h1>  <p id="d43398cb_607">The configuration is done via a 'yaml' file, details below.</p><p id="d43398cb_608">There are two ways to get started:</p><ul class="list _ul" id="d43398cb_609"><li class="list__item" id="d43398cb_610"><p>The first time you run <code class="code" id="d43398cb_611">hms-mirror</code> and it can't find a configuration, it will walk you through building one and save it to <code class="code" id="d43398cb_612">$HOME/.hms-mirror/cfg/default.yaml</code>. Here's what you'll need to complete the setup: </p><ul class="list _ul" id="d43398cb_613"><li class="list__item" id="d43398cb_614"><p>URI's for each clusters HiveServer2</p></li><li class="list__item" id="d43398cb_615"><p>STANDALONE jar files for EACH Hive version. </p><ul class="list _ul" id="d43398cb_616"><li class="list__item" id="d43398cb_617"><p>We support the Apache Hive based drivers for Hive 1 and Hive2/3.</p></li><li class="list__item" id="d43398cb_618"><p>Recently added support for the Cloudera JDBC driver for CDP.</p></li></ul></li><li class="list__item" id="d43398cb_619"><p>Username and Password for non-kerberized connections. </p><ul class="list _ul" id="d43398cb_620"><li class="list__item" id="d43398cb_621"><p>Note: <code class="code" id="d43398cb_622">hms-mirror</code> will only support one kerberos connection. For the other, use another AUTH method.</p></li></ul></li><li class="list__item" id="d43398cb_623"><p>The hcfs (Hadoop Compatible FileSystem) protocol and prefix used for the hive table locations in EACH cluster.</p></li></ul></li><li class="list__item" id="d43398cb_624"><p>Use the <a href="hms-mirror-default-configuration-template.html" id="d43398cb_625" data-tooltip="Default Configuration Template # Copyright 2021 Cloudera, Inc. All Rights Reserved. # # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); # you may not use this file except in compliance with the License. # You may obtain a copy of the License at # #&hellip;">template yaml</a> for reference and create a <code class="code" id="d43398cb_626">default.yaml</code> in the running users <code class="code" id="d43398cb_627">$HOME/.hms-mirror/cfg</code> directory.</p></li></ul><p id="d43398cb_628">You'll need JDBC driver jar files that are * <span class="emphasis" id="d43398cb_629">specific</span> to the clusters you'll integrate. If the <span class="control" id="d43398cb_630">LEFT</span> cluster isn't the same version as the <span class="control" id="d43398cb_631">RIGHT</span> cluster, don't use the same JDBC jar file, especially when integrating Hive 1 and Hive 3 services. The Hive 3 driver is NOT backwardly compatible with Hive 1.</p><p id="d43398cb_632">See the <a href="hms-mirror-running.html" id="d43398cb_633" data-tooltip="After running the setup.sh script, hms-mirror will be available in the $PATH in a default configuration.">running</a> section for examples on running <code class="code" id="d43398cb_634">hms-mirror</code> for various environment types and connections.</p><section class="chapter"><h2 id="jdbc-drivers-and-configuration" data-toc="jdbc-drivers-and-configuration">JDBC Drivers and Configuration</h2><p id="d43398cb_635"><code class="code" id="d43398cb_636">hms-mirror</code> requires JDBC drivers to connect to the various end-points needed to perform it's tasks. The <code class="code" id="d43398cb_637">LEFT</code> and <code class="code" id="d43398cb_638">RIGHT</code> cluster endpoints for HiveServer2 require the standalone JDBC drivers that are specific to that Hive version.</p><p id="d43398cb_639"><code class="code" id="d43398cb_640">hms-mirror</code> supports the Apache and packaged hive <span class="control" id="d43398cb_641">standalone</span> drivers that are found with your distribution. For CDP, we also support to Cloudera JDBC driver found and maintained at on the <a href="https://www.cloudera.com/downloads/connectors/hive/jdbc" id="d43398cb_642" data-external="true" rel="noopener noreferrer">Cloudera Hive JDBC Downloads Page</a>. Note that the URL configurations between the Apache and Cloudera JDBC drivers are different.</p><p id="d43398cb_643">When using the Cloudera JDBC driver, you'll need to add the property <code class="code" id="d43398cb_644">driverClassName: &quot;com.cloudera.hive.jdbc.HS2Driver&quot;</code> to the <code class="code" id="d43398cb_645">hiveServer2</code> configuration. If you're NOT using the Cloudera JDBC driver, just remove the property.</p><div class="code-block" data-lang="yaml">
hiveServer2:
  uri: &quot;&lt;cloudera_jdbc_url&gt;&quot;
  driverClassName: &quot;com.cloudera.hive.jdbc.HS2Driver&quot;
  connectionProperties:
    user: &quot;xxx&quot;
    password: &quot;xxx&quot;
</div><p id="d43398cb_647">Starting with the Apache Standalone driver shipped with CDP 7.1.8 cummulative hot fix parcels, you will need to include additional jars in the configuration <code class="code" id="d43398cb_648">jarFile</code> configuration, due to some packaging adjustments.</p><p id="d43398cb_649">For example: <code class="code" id="d43398cb_650">jarFile: &quot;&lt;cdp_parcel_jars&gt;/hive-jdbc-3.1.3000.7.1.8.28-1-standalone.jar:&lt;cdp_parcel_jars&gt;/log4j-1.2-api-2.18.0.jar:&lt;cdp_parcel_jars&gt;/log4j-api-2.18.0.jar:&lt;cdp_parcel_jars&gt;/log4j-core-2.18.0.jar&quot;</code> NOTE: The jar file with the Hive Driver MUST be the first in the list of jar files.</p><p id="d43398cb_651">The Cloudera JDBC driver shouldn't require additional jars.</p><section class="chapter"><h3 id="example-urls" data-toc="example-urls">Example URLs</h3><section class="chapter"><h4 id="cdp-hive-via-knox-gateway" data-toc="cdp-hive-via-knox-gateway">CDP Hive via Knox Gateway</h4><p id="d43398cb_652">Doesn't require Kerberos. Knox is SSL, so depending on whether you've self-signed your certs you may need to make adjustments.</p><ul class="list _ul" id="d43398cb_653"><li class="list__item" id="d43398cb_654"><p>Apache Hive and CDP Packaged Apache Hive JDBC Driver</p></li></ul><aside class="prompt" data-type="tip" data-title="" id="d43398cb_655"><p id="d43398cb_656"><code class="code" id="d43398cb_657">jdbc:hive2://s03.streever.local:8443/;ssl=true;transportMode=http;httpPath=gateway/cdp-proxy-api/hive;sslTrustStore=/Users/dstreev/bin/certs/gateway-client-trust.jks;trustStorePassword=changeit</code></p></aside><ul class="list _ul" id="d43398cb_658"><li class="list__item" id="d43398cb_659"><p>Cloudera JDBC Driver</p></li></ul><aside class="prompt" data-type="tip" data-title="" id="d43398cb_660"><p id="d43398cb_661"><code class="code" id="d43398cb_662">jdbc:hive2://s03.streever.local:8443;transportMode=http;AuthMech=3;httpPath=gateway/cdp-proxy-api/hive;SSL=1;AllowSelfSignedCerts=1</code></p></aside></section><section class="chapter"><h4 id="cdp-hive-direct-with-kerberos" data-toc="cdp-hive-direct-with-kerberos">CDP Hive direct with Kerberos</h4><p id="d43398cb_663">When connecting to via Kerberos, place the JDBC driver for Hive in the <code class="code" id="d43398cb_664">$HOME/.hms-mirror/aux_libs</code> directory. This ensures it is loaded in the classpath correctly to support the kerberos connection. If you're NOT using Kerberos connection, the libraries should be reference in the <code class="code" id="d43398cb_665">jarFile</code> parameter and NOT be in the <code class="code" id="d43398cb_666">aux_libs</code> directory.</p><p id="d43398cb_667">If you are experimenting with different connection types, ensure the jar file is REMOVED from <code class="code" id="d43398cb_668">aux_libs</code> when trying other configurations.</p><ul class="list _ul" id="d43398cb_669"><li class="list__item" id="d43398cb_670"><p>Apache JDBC Driver (packaged with CDP)</p></li></ul><aside class="prompt" data-type="tip" data-title="" id="d43398cb_671"><p id="d43398cb_672"><code class="code" id="d43398cb_673">tbd</code> NOTE: Our experience with this driver is that requires the use of <code class="code" id="d43398cb_674">--hadoop-classpath</code> in the commandline to load the needed kerberos libraries.</p></aside><ul class="list _ul" id="d43398cb_675"><li class="list__item" id="d43398cb_676"><p>Cloudera JDBC Driver</p></li></ul><aside class="prompt" data-type="tip" data-title="" id="d43398cb_677"><p id="d43398cb_678"><code class="code" id="d43398cb_679">jdbc:hive2://s04.streever.local:10001;transportMode=http;AuthMech=1;KrbRealm=STREEVER.LOCAL;KrbHostFQDN=s04.streever.local;KrbServiceName=hive;KrbAuthType=2;httpPath=cliservice;SSL=1;AllowSelfSignedCerts=1</code> NOTE: When using this driver, our experience has been that you do NOT need to use <code class="code" id="d43398cb_680">--hadoop-classpath</code> as a commandline element with versions 1.6.1.0+</p></aside></section><section class="chapter"><h4 id="hdp2-hs2-with-no-auth" data-toc="hdp2-hs2-with-no-auth">HDP2 HS2 with No Auth</h4><p id="d43398cb_681">Since CDP is usually kerberized AND <code class="code" id="d43398cb_682">hms-mirror</code> doesn't support the simultanous connections to 2 different kerberos environments, I've setup an HS2 on HDP2 specifically for this effort. NOTE: You need to specify a <code class="code" id="d43398cb_683">username</code> when connecting to let Hive know what the user is. No password required.</p><ul class="list _ul" id="d43398cb_684"><li class="list__item" id="d43398cb_685"><p>Apache Hive Standalone Driver shipped with HDP2.</p></li></ul><aside class="prompt" data-type="tip" data-title="" id="d43398cb_686"><p id="d43398cb_687"><code class="code" id="d43398cb_688">jdbc:hive2://k02.streever.local:10000</code></p></aside></section></section><section class="chapter"><h3 id="direct-metastore-db-acceess-for-epl" data-toc="direct-metastore-db-acceess-for-epl">Direct Metastore DB Acceess for -epl</h3><p id="d43398cb_689">The <code class="code" id="d43398cb_690">LEFT</code> and <code class="code" id="d43398cb_691">RIGHT</code> configurations also suppport 'direct' metastore access to collect detailed partition information when using the flag <code class="code" id="d43398cb_692">-epl</code>. The support this feature, get the JDBC driver that is appropriate for your metastore(s) backend dbs and place it in <code class="code" id="d43398cb_693">$HOME/.hms-mirror/aux_libs</code> directory.</p></section></section><section class="chapter"><h2 id="secure-passwords-in-configuration" data-toc="secure-passwords-in-configuration">Secure Passwords in Configuration</h2><p id="d43398cb_694">There are two passwords stored in the configuration file mentioned above. One for each 'JDBC connection, if those rely on a password for connect. By default, the passwords are in clear text in the configuration file. This usually isn't an issue since the file can be protected at the UNIX level from peering eyes. But if you need to protect those passwords, <code class="code" id="d43398cb_695">hms-mirror</code> supports storing an encrypted version of the password in the configuration.</p><p id="d43398cb_696">The <code class="code" id="d43398cb_697">password</code> element for each JDBC connection can be replaced with an <span class="control" id="d43398cb_698">encrypted</span> version of the password and read by <code class="code" id="d43398cb_699">hms-mirror</code> during execution, so the clear text version of the password isn't persisted anywhere.</p><p id="d43398cb_700">When you're using this feature, you need to have a <code class="code" id="d43398cb_701">password-key</code>. This is a key used to encrypt and decrypt the password in the configuration. The same <code class="code" id="d43398cb_702">password-key</code> must be used for each password in the configuration file.</p><section class="chapter"><h3 id="generate-the-encrypted-password" data-toc="generate-the-encrypted-password">Generate the Encrypted Password</h3><p id="d43398cb_703">Use the <code class="code" id="d43398cb_704">-pkey</code> and <code class="code" id="d43398cb_705">-p</code> options of <code class="code" id="d43398cb_706">hms-mirror</code></p><p id="d43398cb_707"><code class="code" id="d43398cb_708">hms-mirror -pkey cloudera -p have-a-nice-day</code></p><p id="d43398cb_709">Will generate:</p><div class="code-block" data-lang="none">
...
Encrypted password: HD1eNF8NMFahA2smLM9c4g==
</div><p id="d43398cb_711">Copy this encrypted password and place it in your configuration file for the JDBC connection. Repeat for the other passwords, if it's different, and paste it in the configuration as well.</p></section><section class="chapter"><h3 id="running-hms-mirror-with-encrypted-passwords" data-toc="running-hms-mirror-with-encrypted-passwords">Running hms-mirror with Encrypted Passwords</h3><p id="d43398cb_712">Using the <span class="control" id="d43398cb_713">same</span> <code class="code" id="d43398cb_714">-pkey</code> you used to generate the encrypted password, we'll run <code class="code" id="d43398cb_715">hms-mirror</code></p><p id="d43398cb_716"><code class="code" id="d43398cb_717">hms-mirror -db &lt;db&gt; -pkey cloudera ...</code></p><p id="d43398cb_718">When the <code class="code" id="d43398cb_719">-pkey</code> option is specified <span class="control" id="d43398cb_720">WITHOUT</span> the <code class="code" id="d43398cb_721">-p</code> option (used previously), <code class="code" id="d43398cb_722">hms-mirror</code> will understand to <span class="control" id="d43398cb_723">decrypt</span> the configuration passwords before connecting to jdbc. If you receive jdbc connection exceptions, recheck the <code class="code" id="d43398cb_724">-pkey</code> and encrypted password from before.</p></section></section><div class="last-modified">Last modified: 23 January 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"> <a href="hms-mirror-setup.html" class="navigation-links__prev">Setup</a><a href="hms-mirror-default-configuration-template.html" class="navigation-links__next">Default Configuration Template</a> </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>