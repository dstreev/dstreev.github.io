<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-05-01T09:50:19.03773"><title>Warning | hms-mirror</title><script type="application/json" id="virtual-toc-data">[{"id":"building-metadata","level":0,"title":"Building METADATA","anchor":"#building-metadata"},{"id":"partition-handling-for-data-transfers","level":0,"title":"Partition Handling for Data Transfers","anchor":"#partition-handling-for-data-transfers"},{"id":"permissions","level":0,"title":"Permissions","anchor":"#permissions"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b259/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Warning | hms-mirror"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="hms-mirror Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/hms-mirror/v2.0.x/warning.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Warning | hms-mirror"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/hms-mirror/v2.0.x/warning.html#webpage",
    "url": "writerside-documentation/hms-mirror/v2.0.x/warning.html",
    "name": "Warning | hms-mirror",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/hms-mirror/#website",
    "url": "writerside-documentation/hms-mirror/",
    "name": "hms-mirror Help"
}</script><!-- End Schema.org --></head><body data-id="warning" data-main-title="Warning" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Pre-Requisites.md|Pre-Requisites"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>hms-mirror v2.0.x Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="warning" id="warning.md">Warning</h1><section class="chapter"><h2 id="building-metadata" data-toc="building-metadata">Building METADATA</h2><p id="raysu5_184">Rebuilding METADATA can be an expensive scenario. Especially when you are trying to reconstruct the entire metastore in a short time period, consider this in your planning. Know the number of partitions and buckets you will be moving and account for this. Test on smaller datasets (volume and metadata elements). Progress to testing higher volumes/partition counts to find limits and make adjustments to your strategy.</p><p id="raysu5_185">Using the SQL and EXPORT_IMPORT strategies will move metadata AND data, but rebuilding the metastore elements can be pretty expensive. So consider migrating the metadata separately from the data (distcp) and use MSCK on the RIGHT cluster to discover the data. This will be considerably more efficient.</p><p id="raysu5_186">If you will be doing a lot of metadata work on the RIGHT cluster. That cluster also serves a current user base; consider setting up separate HS2 pods for the migration to minimize the impact on the current user community. <a href="hms-mirror-optimizations.html#isolate-migration-activities" id="raysu5_187" data-tooltip="The migration of schemas can put a heavy load on HS2 and the HMS server it's using. That impact can manifest itself as 'pauses' for other clients trying to run queries. Extended schema/discovery operations have a 'blocking' tendency in HS2.">Isolate Migration Activities</a></p></section><section class="chapter"><h2 id="partition-handling-for-data-transfers" data-toc="partition-handling-for-data-transfers">Partition Handling for Data Transfers</h2><p id="raysu5_188">There are three settings in the configuration to control how and to what extent we'll attempt to migrate <span class="emphasis" id="raysu5_189">DATA</span> for tables with partitions.</p><p id="raysu5_190">For non-ACID/transactional tables the setting in:</p><div class="code-block" data-lang="yaml">
hybrid:
  exportImportPartitionLimit: 100
  sqlPartitionLimit: 500
</div><p id="raysu5_192">Control both the <code class="code" id="raysu5_193">HYBRID</code> strategy for selecting either <code class="code" id="raysu5_194">EXPORT_IMPORT</code> or <code class="code" id="raysu5_195">SQL</code> and the <code class="code" id="raysu5_196">SQL</code> <span class="emphasis" id="raysu5_197">LIMIT</span> for how many partitions we'll attempt. When the <code class="code" id="raysu5_198">SQL</code> limit is exceeded, you will need to use <code class="code" id="raysu5_199">SCHEMA_ONLY</code> to migrate the schema followed by <code class="code" id="raysu5_200">distcp</code> to move the data.</p><p id="raysu5_201">For ACID/transactional tables, the setting in:</p><div class="code-block" data-lang="yaml">
migrateACID:
  partitionLimit: 500
</div><p id="raysu5_203">Effectively draws the same limit as above.</p><p id="raysu5_204">Why do we have these limits? Mass migration of datasets via SQL and EXPORT_IMPORT with many partitions is costly and NOT very efficient. It's best that when these limits are reached that you separate the METADATA and DATA migration to DDL and distcp.</p></section><section class="chapter"><h2 id="permissions" data-toc="permissions">Permissions</h2><p id="raysu5_205">We use a cross-cluster technique to back metadata in the RIGHT cluster with datasets in the LEFT cluster for data strategies: LINKED, HYBRID, EXPORT_IMPORT, SQL, and SCHEMA_ONLY (with <code class="code" id="raysu5_206">-ams</code> AVRO Migrate Schema).</p><p id="raysu5_207">See <a href="linking-cluster-storage-layers.html" id="raysu5_208" data-tooltip="For the hms-mirror process to work, it relies on the RIGHT clusters' ability to SEE and ACCESS data in the LEFT clusters HDFS namespace. This is the same access/configuration required to support DISTCP for an HA environment and accounts for failovers.">Linking Clusters Storage Layers</a> for details on configuring this state.</p></section><div class="last-modified">Last modified: 01 May 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="pre-requisites.html" class="navigation-links__prev">Pre-Requisites</a><a href="hms-mirror-permissions.html" class="navigation-links__next">Permissions</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b259/app.js"></script></body></html>