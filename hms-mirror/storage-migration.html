<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2025-02-09T05:56:51.852704"><title>STORAGE_MIGRATION | hms-mirror</title><script type="application/json" id="virtual-toc-data">[{"id":"important-properties","level":0,"title":"Important Properties","anchor":"#important-properties"},{"id":"demo","level":0,"title":"Demo","anchor":"#demo"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="STORAGE_MIGRATION | hms-mirror"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="hms-mirror Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/hms-mirror/v2.3.0.x/storage-migration.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="STORAGE_MIGRATION | hms-mirror"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/hms-mirror/v2.3.0.x/storage-migration.html#webpage",
    "url": "writerside-documentation/hms-mirror/v2.3.0.x/storage-migration.html",
    "name": "STORAGE_MIGRATION | hms-mirror",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/hms-mirror/#website",
    "url": "writerside-documentation/hms-mirror/",
    "name": "hms-mirror Help"
}</script><!-- End Schema.org --></head><body data-id="STORAGE_MIGRATION" data-main-title="STORAGE_MIGRATION" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Strategies.md|Strategies"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>hms-mirror v2.3.0.x Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="STORAGE_MIGRATION" id="STORAGE_MIGRATION.md">STORAGE_MIGRATION</h1><p id="z6okjbb_3">The Storage Migration feature in <code class="code" id="z6okjbb_13">hms-mirror</code> is used to migrate 'data' from one storage location to another in the same metastore.</p><p id="z6okjbb_4">For example: You have all of you databases data on 'HDFS' and you want to more it to 'Ozone' while keeping all the same details about the tables, columns, etc. in the metastore so there's minimal impact to the applications using the database/tables.</p><p id="z6okjbb_5">One of the tricky parts of this type of migration is how you'll want to handle going from a 'single' namespace environment to a 'multi' namespace environment. This is the case when migrating from HDFS to Ozone. Ozone features, and multi-tenant capabilities are different than HDFS. On HDFS, it's ok to have all you databases in a single parent folder (Warehouse Directory). But with Ozone, you do NOT want to do that. This isn't necessarily an 'Ozone' only adjustment. This applies to cloud storage (S3, ADLS, GFS) too.</p><p id="z6okjbb_6">In this case, you'll want to organize your databases into separate 'namespaces' on the storage system. We're using the term 'namespace' loosely here. It could be a 'bucket' in S3, a 'container' in ADLS, or a 'volume/bucket' in Ozone. Regardless, the point is that we need to be able to handle each database as a separate entity in the storage migration process and allow for each database to be migrated to a different 'namespace' in the target storage system.</p><p id="z6okjbb_7">Let's take a look at the following example in table format.</p><div class="table-wrapper"><table class="wide" id="z6okjbb_8"><thead><tr class="ijRowHead" id="z6okjbb_14"><th id="z6okjbb_19"><p>Group</p></th><th id="z6okjbb_20"><p>Database Name</p></th><th id="z6okjbb_21"><p>HDFS</p><br><p> External Location</p></th><th id="z6okjbb_22"><p>HDFS</p><br><p> Managed Location</p></th><th id="z6okjbb_23"><p>Ozone</p><br><p> External Location</p></th><th id="z6okjbb_24"><p>Ozone</p><br><p> Managed Location</p></th></tr></thead><tbody><tr id="z6okjbb_15"><td id="z6okjbb_29"><p>finance</p></td><td id="z6okjbb_30"><p>db1</p></td><td id="z6okjbb_31"><p>/warehouse/tablespace/hive/external/db1.db</p></td><td id="z6okjbb_32"><p>/warehouse/tablespace/hive/managed/db1.db</p></td><td id="z6okjbb_33"><p>/finance/external/db1.db</p></td><td id="z6okjbb_34"><p>/finance/managed/db1.db</p></td></tr><tr id="z6okjbb_16"><td id="z6okjbb_35"><p>finance</p></td><td id="z6okjbb_36"><p>db2</p></td><td id="z6okjbb_37"><p>/warehouse/tablespace/hive/external/db2.db</p></td><td id="z6okjbb_38"><p>/warehouse/tablespace/hive/managed/db2.db</p></td><td id="z6okjbb_39"><p>/finance/external/db2.db</p></td><td id="z6okjbb_40"><p>/finance/managed/db2.db</p></td></tr><tr id="z6okjbb_17"><td id="z6okjbb_41"><p>hr</p></td><td id="z6okjbb_42"><p>db3</p></td><td id="z6okjbb_43"><p>/warehouse/tablespace/hive/external/db3.db</p></td><td id="z6okjbb_44"><p>/warehouse/tablespace/hive/managed/db3.db</p></td><td id="z6okjbb_45"><p>/hr/external/db3.db</p></td><td id="z6okjbb_46"><p>/hr/managed/db3.db</p></td></tr><tr id="z6okjbb_18"><td id="z6okjbb_47"><p>hr</p></td><td id="z6okjbb_48"><p>db4</p></td><td id="z6okjbb_49"><p>/warehouse/tablespace/hive/external/db4.db</p></td><td id="z6okjbb_50"><p>/warehouse/tablespace/hive/managed/db4.db</p></td><td id="z6okjbb_51"><p>/hr/external/db4.db</p></td><td id="z6okjbb_52"><p>/hr/managed/db4.db</p></td></tr></tbody></table></div><p id="z6okjbb_9">In the above example, we have 2 owners (finance, hr) and 4 databases (db1, db2, db3, db4). In the legacy environment (HDFS), all databases are in the same parent folder. In the target environment (Ozone), we want to take advantage of the multi-tenant capabilities and separate the databases into separate 'namespaces'. This is done by creating different 'volume/bucket' areas for each 'Owner' and then placing the databases in those areas. To further illustrate separation, look how we established the 'external' and 'managed' locations for each database.</p><p id="z6okjbb_10"><code class="code" id="z6okjbb_53">hms-mirror</code> helps you build <a href="database-warehouse-plans.html" id="z6okjbb_54" data-tooltip="">Warehouse Plans</a> to handle these types of migrations. Each database to migrate will have a 'Warehouse Plan' that will define how to handle the migration.</p><section class="chapter"><h2 id="important-properties" data-toc="important-properties">Important Properties</h2><p id="z6okjbb_55">The following screen shot shows the properties that are important for the Storage Migration feature.</p><figure id="z6okjbb_56"><img alt="sm_dm_screen.png" src="images/sm_dm_screen.png" title="sm_dm_screen.png" width="991" height="421"></figure><p id="z6okjbb_57"><span class="control" id="z6okjbb_65">Target Namespace</span></p><p id="z6okjbb_58">Identifies the 'namespace' where all the translations will be made to.</p><p id="z6okjbb_59"><span class="control" id="z6okjbb_66">Location Translation Strategy</span></p><p id="z6okjbb_60">RELATIVE or ALIGNED. In this case, we DO want to ALIGN the locations with the new 'namespace' and locations defined in the Warehouse Plan for the database.</p><p id="z6okjbb_61"><span class="control" id="z6okjbb_67">Movement Strategy</span></p><p id="z6okjbb_62">DISTCP or SQL. This will direct <code class="code" id="z6okjbb_68">hms-mirror</code> to build a <code class="code" id="z6okjbb_69">distcp</code> plan/scripts or construct <code class="code" id="z6okjbb_70">SQL</code> to move the data.</p><p id="z6okjbb_63"><span class="control" id="z6okjbb_71">Skip Database Location Adjustments</span></p><p id="z6okjbb_64">Defaults to 'false'. If you want to skip the location adjustments, set this to 'true'. This is useful if you're trying to archive tables in a database to another storage system, but want to leave the database location as is for new tables in the database.</p></section><section class="chapter"><h2 id="demo" data-toc="demo">Demo</h2><p id="z6okjbb_72">Here's how the Warehouse Plans would look for the above example:</p><figure id="z6okjbb_73"><img alt="warehouseplans_01.png" src="images/warehouseplans_01.png" title="warehouseplans_01.png" width="627" height="389"></figure><p id="z6okjbb_74">Here's one of the report details for the 'finance.db1' database. See how the 'external' and 'managed' locations are have been altered to reflect the new 'namespace' structure in Ozone we requested in the Warehouse Plan.</p><figure id="z6okjbb_75"><img alt="warehouseplan_01_rpt.png" src="images/warehouseplan_01_rpt.png" title="warehouseplan_01_rpt.png" width="2226" height="1592"></figure></section><div class="last-modified">Last modified: 09 February 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="common.html" class="navigation-links__prev">COMMON</a><a href="hms-mirror-iceberg-migration.html" class="navigation-links__next">ICEBERG_MIGRATION</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.js"></script></body></html>