<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2025-02-09T05:56:51.892761"><title>Hive JDBC Drivers and Configuration | hms-mirror</title><script type="application/json" id="virtual-toc-data">[{"id":"kerberized-hs2-connections","level":0,"title":"Kerberized HS2 Connections","anchor":"#kerberized-hs2-connections"},{"id":"validating-hs2-connectivity","level":0,"title":"Validating HS2 Connectivity","anchor":"#validating-hs2-connectivity"},{"id":"hdp-3-connections","level":0,"title":"HDP 3 Connections","anchor":"#hdp-3-connections"},{"id":"hive-jdbc-driver-connection-pool-settings","level":0,"title":"Hive JDBC Driver Connection Pool Settings","anchor":"#hive-jdbc-driver-connection-pool-settings"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Hive JDBC Drivers and Configuration | hms-mirror"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="hms-mirror Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/hms-mirror/v2.3.0.x/jdbc-drivers-and-configuration.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Hive JDBC Drivers and Configuration | hms-mirror"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/hms-mirror/v2.3.0.x/jdbc-drivers-and-configuration.html#webpage",
    "url": "writerside-documentation/hms-mirror/v2.3.0.x/jdbc-drivers-and-configuration.html",
    "name": "Hive JDBC Drivers and Configuration | hms-mirror",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/hms-mirror/#website",
    "url": "writerside-documentation/hms-mirror/",
    "name": "hms-mirror Help"
}</script><!-- End Schema.org --></head><body data-id="JDBC-Drivers-and-Configuration" data-main-title="Hive JDBC Drivers and Configuration" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="hms-mirror-cfg.md|Configuration"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>hms-mirror v2.3.0.x Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="JDBC-Drivers-and-Configuration" id="JDBC-Drivers-and-Configuration.md">Hive JDBC Drivers and Configuration</h1><p id="-jqx5ir_3"><code class="code" id="-jqx5ir_17">hms-mirror</code> requires JDBC drivers to connect to the various end-points needed to perform tasks. The <code class="code" id="-jqx5ir_18">LEFT</code> and <code class="code" id="-jqx5ir_19">RIGHT</code> cluster endpoints for HiveServer2 require the standalone JDBC drivers that are specific to that Hive version.</p><p id="-jqx5ir_4"><code class="code" id="-jqx5ir_20">hms-mirror</code> supports the Apache Hive packaged <span class="control" id="-jqx5ir_21">standalone</span> drivers that are found with your distribution. You can find a copy of this driver in:</p><div class="table-wrapper"><table class="wide" id="-jqx5ir_5"><thead><tr class="ijRowHead" id="-jqx5ir_22"><th id="-jqx5ir_26"><p>Platform</p></th><th id="-jqx5ir_27"><p>Driver Location/Pattern</p></th></tr></thead><tbody><tr id="-jqx5ir_23"><td id="-jqx5ir_28"><p>HDP</p></td><td id="-jqx5ir_29"><p><code class="code" id="-jqx5ir_30">/usr/hdp/current/hive-client/jdbc/hive-jdbc-&lt;hive-platform-version&gt;-standalone.jar</code></p></td></tr><tr id="-jqx5ir_24"><td id="-jqx5ir_31"><p>CDP</p></td><td id="-jqx5ir_32"><p><code class="code" id="-jqx5ir_33">/opt/cloudera/parcels/CDH/jars/hive-jdbc-&lt;hive-platform-version&gt;-standalone.jar</code></p></td></tr><tr id="-jqx5ir_25"><td id="-jqx5ir_34"></td><td id="-jqx5ir_35"></td></tr></tbody></table></div><p id="-jqx5ir_6">For CDP, we also support to Cloudera JDBC driver found and maintained at on the <a href="https://www.cloudera.com/downloads/connectors/hive/jdbc" id="-jqx5ir_36" data-external="true" rel="noopener noreferrer">Cloudera Hive JDBC Downloads Page</a>. Note that the URL configurations between the Apache and Cloudera JDBC drivers are different.</p><p id="-jqx5ir_7">Hive JDBC Drivers need to be inline with the version of HS2 you're connecting to. If the cluster is an HDP cluster, get the appropriate <span class="control" id="-jqx5ir_37">standalone</span> driver from that cluster. These drivers(jar files) should be stored locally on the machine running <code class="code" id="-jqx5ir_38">hms-mirror</code> and referenced in the configuration file.</p><aside class="prompt" data-type="warning" data-title="" id="-jqx5ir_8"><p>Do NOT put these drivers in ${HOME}/.hms-mirror/aux_libs or any sub-directory of that location. `hms-mirror` connects to different versions of Hive and the drivers need to be specific to the version of Hive you're connecting to. To do this, we need to manage the classpath and the drivers in a more controlled manner. They should NOT be in the applications main classpath which includes jar files in `$HOME/.hms-mirror/aux_libs`, this will cause connectivity issues.</p></aside><div class="tabs" id="-jqx5ir_9" data-anchors="[-jqx5ir_39,cli-hs2]"><div class="tabs__content" data-gtm="tab" id="-jqx5ir_39" data-title="Web UI"><p><b id="-jqx5ir_41">Hive Server 2 Configuration</b></p><figure id="-jqx5ir_42"><img alt="hs2_cfg.png" src="images/hs2_cfg.png" title="hs2_cfg.png" width="851" height="396"></figure></div><div class="tabs__content" data-gtm="tab" id="cli-hs2" data-title="CLI"><div class="code-block" data-lang="yaml" data-title="yaml">
hiveServer2:
  uri: &quot;&lt;cloudera_jdbc_url&gt;&quot;
  driverClassName: &quot;com.cloudera.hive.jdbc.HS2Driver&quot;
  connectionProperties:
    user: &quot;xxx&quot;
    password: &quot;xxx&quot;
</div></div></div><p id="-jqx5ir_10">Starting with the Apache Standalone driver shipped with <span class="control" id="-jqx5ir_44">CDP 7.1.8 cummulative</span> hot fix parcels, you will need to include additional jars in the configuration <code class="code" id="-jqx5ir_45">jarFile</code> configuration, due to some packaging adjustments.</p><p id="-jqx5ir_11">For example: <code class="code" id="-jqx5ir_46">jarFile: &quot;&lt;cdp_parcel_jars&gt;/hive-jdbc-3.1.3000.7.1.8.28-1-standalone.jar:&lt;cdp_parcel_jars&gt;/log4j-1.2-api-2.18.0.jar:&lt;cdp_parcel_jars&gt;/log4j-api-2.18.0.jar:&lt;cdp_parcel_jars&gt;/log4j-core-2.18.0.jar&quot;</code> NOTE: The jar file with the Hive Driver MUST be the first in the list of jar files.</p><p id="-jqx5ir_12">The Cloudera JDBC driver shouldn't require additional jars.</p><section class="chapter"><h2 id="kerberized-hs2-connections" data-toc="kerberized-hs2-connections">Kerberized HS2 Connections</h2><p id="-jqx5ir_47">We currently have validated <span class="control" id="-jqx5ir_54">kerberos</span> HS2 connections to CDP clusters using the Hive JDBC driver you'll find in your target CDP distribution.</p><aside class="prompt" data-type="warning" data-title="" id="-jqx5ir_48"><p>Connections to Kerberized HS2 endpoints on NON-CDP clusters is NOT currently supported. You will need to use KNOX in HDP to connect to a kerberized HS2 endpoint. For CDH, you can setup a non-kerberized HS2 endpoint to support the migration.</p></aside><aside class="prompt" data-type="note" data-title="" id="-jqx5ir_49"><p>This process has CHANGED compared to v1.x of `hms-mirror`. Please adjust your configurations accordingly.</p></aside><p id="-jqx5ir_50">We NO LONGER need to have the hive JDBC driver in the <code class="code" id="-jqx5ir_55">aux_libs</code> directory ($HOME/.hms-mirror/aux_libs). The driver should be stored locally on the machine running <code class="code" id="-jqx5ir_56">hms-mirror</code> and referenced in the configuration file via the `jarFile' attribute. Follow the same procedure as above for <span class="control" id="-jqx5ir_57">Kerberized</span> connections as is done for non-kerberized connections.</p><figure id="-jqx5ir_51"><img alt="hs2_kerb_config.png" src="images/hs2_kerb_config.png" title="hs2_kerb_config.png" width="1041" height="507"></figure><p id="-jqx5ir_52">At this point, just like the previous version of <code class="code" id="-jqx5ir_58">hms-mirror</code>, you'll need to have a valid kerberos ticket on the machine running <code class="code" id="-jqx5ir_59">hms-mirror</code>. This is required to authenticate to the kerberized HS2 endpoint.</p><p id="-jqx5ir_53">REMOVE all 'hive' related JDBC jar files from <code class="code" id="-jqx5ir_60">aux_libs</code>. Leaving them there WILL cause conflicts during the service startup.</p></section><section class="chapter"><h2 id="validating-hs2-connectivity" data-toc="validating-hs2-connectivity">Validating HS2 Connectivity</h2><p id="-jqx5ir_61">Once you have everything configured, you can validate all connections required by <code class="code" id="-jqx5ir_62">hms-mirror</code> through the 'CONNECTIONS --&gt; Validate' left menu option in the UI. This will test the connectivity to the various endpoints required by <code class="code" id="-jqx5ir_63">hms-mirror</code>.</p></section><section class="chapter"><h2 id="hdp-3-connections" data-toc="hdp-3-connections">HDP 3 Connections</h2><p id="-jqx5ir_64">The JDBC driver for HDP Hive 3 has some embedded classes for <code class="code" id="-jqx5ir_65">log4j</code> that conflict with the <code class="code" id="-jqx5ir_66">log4j</code> classes in the <code class="code" id="-jqx5ir_67">hms-mirror</code> application. To resolve this, you can use the Cloudera Apache JDBC driver for HDP 3 Hive. This driver is compatible with HDP 3 and does not have the <code class="code" id="-jqx5ir_68">log4j</code> conflict.</p></section><section class="chapter"><h2 id="hive-jdbc-driver-connection-pool-settings" data-toc="hive-jdbc-driver-connection-pool-settings">Hive JDBC Driver Connection Pool Settings</h2><p id="-jqx5ir_69">Hive 1/2, which includes HDP 2.x and CDH 5.x / 6.x environments will use the Apache Commons DBCP2 Connection Pool libraries. Hive 3/4, which includes HDP 3.x and CDH 7.x environments will use the HikariCP Connection Pool libraries.</p><p id="-jqx5ir_70">There are a few settings that you can adjust in the <code class="code" id="-jqx5ir_75">hms-mirror</code> configuration file to tune the connection pool settings.</p><p id="-jqx5ir_71">For the DBCP2 connection pool, you can set the <code class="code" id="-jqx5ir_76">maxWaitMillis</code> setting, which has a default of <code class="code" id="-jqx5ir_77">5000</code> milliseconds.</p><p id="-jqx5ir_72">For the HikariCP connection pool, the following connection properties can be adjusted: <code class="code" id="-jqx5ir_78">connectionTimeout</code> (default: <code class="code" id="-jqx5ir_79">60000</code> milliseconds) <code class="code" id="-jqx5ir_80">validationTimeout</code> (default: <code class="code" id="-jqx5ir_81">30000</code> milliseconds) <code class="code" id="-jqx5ir_82">initializationFailTimeout</code> (default: <code class="code" id="-jqx5ir_83">10000</code> milliseconds)</p><p id="-jqx5ir_73">The default setting have been pretty successful in our testing, but you can adjust these settings to meet your needs.</p><div class="tabs" id="-jqx5ir_74" data-anchors="[-jqx5ir_84,-jqx5ir_85,-jqx5ir_86]"><div class="tabs__content" data-gtm="tab" id="-jqx5ir_84" data-title="CLI"><p id="-jqx5ir_87">The DBCP2 connection pool settings can be adjustment through the CLI via the <code class="code" id="-jqx5ir_94">-pt|--pass-through</code> option using one of more of the following setting:</p><ul class="list _bullet" id="-jqx5ir_88"><li class="list__item" id="-jqx5ir_95"><p><code class="code" id="-jqx5ir_96">dbcp2.maxWaitMillis</code></p></li></ul><p id="-jqx5ir_89">EG: <code class="code" id="-jqx5ir_97">-pt dbcp2.maxWaitMillis=10000</code></p><p id="-jqx5ir_90">The Hikari connection pool settings can be adjusted through the CLI via the <code class="code" id="-jqx5ir_98">-pt|--pass-through</code> option using one of more of the following setting:</p><ul class="list _bullet" id="-jqx5ir_91"><li class="list__item" id="-jqx5ir_99"><p><code class="code" id="-jqx5ir_102">hikari.connectionTimeout</code></p></li><li class="list__item" id="-jqx5ir_100"><p><code class="code" id="-jqx5ir_103">hikari.validationTimeout</code></p></li><li class="list__item" id="-jqx5ir_101"><p><code class="code" id="-jqx5ir_104">hikari.initializationFailTimeout</code></p></li></ul><aside class="prompt" data-type="note" data-title="" id="-jqx5ir_92"><p>You can have multiple `-pt` options on the command line</p></aside><p id="-jqx5ir_93">EG: <code class="code" id="-jqx5ir_105">-pt hikari.connectionTimeout=60000 -pt hikari.validationTimeout=30000 -pt hikari.initializationFailTimeout=10000</code></p></div><div class="tabs__content" data-gtm="tab" id="-jqx5ir_85" data-title="Web UI"><p id="-jqx5ir_106"><figure id="-jqx5ir_107"><img alt="hs2_cp_settings.png" src="images/hs2_cp_settings.png" title="hs2_cp_settings.png" width="775" height="560"></figure><figure id="-jqx5ir_108"><img alt="filter_databases.png" src="images/filter_databases.png" title="filter_databases.png" width="531" height="196"></figure></p></div><div class="tabs__content" data-gtm="tab" id="-jqx5ir_86" data-title="Config File"><div class="code-block" data-lang="yaml" data-title="yaml">
clusters:
  LEFT:
    environment: &quot;LEFT|RIGHT&quot;
    hiveServer2:
      uri: &quot;...&quot;
      connectionProperties:
        maxWaitMillis: &quot;5000&quot; # DBCP2 connection pool setting
        hikari.validationTimeout: &quot;30000&quot;
        hikari.initializationFailTimeout: &quot;10000&quot;
        hikari.connectionTimeout: &quot;60000&quot;
</div></div></div></section><div class="last-modified">Last modified: 09 February 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="hms-mirror-setup.html" class="navigation-links__prev">Setup</a><a href="example-url-s.html" class="navigation-links__next">Example URL&apos;s</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.js"></script></body></html>