<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-11-07T07:59:38.330858"><meta name="build-number" content="${buildNumber}">       <title>SRE Application (sre) | hive-sre</title><script id="virtual-toc-data" type="application/json">[{"id":"known-issues","level":0,"title":"Known Issues","anchor":"#known-issues"},{"id":"assumptions","level":0,"title":"Assumptions","anchor":"#assumptions"},{"id":"application-help","level":0,"title":"Application Help","anchor":"#application-help"},{"id":"sre-processes","level":0,"title":"sre Processes","anchor":"#sre-processes"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.1.5-b176/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="SRE Application (sre) | hive-sre"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="hive-sre Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="hive-srehive-sre-sre.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="SRE Application (sre) | hive-sre"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "hive-srehive-sre-sre.html#webpage", "url": "hive-srehive-sre-sre.html", "name": "SRE Application (sre) | hive-sre", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "hive-sre/#website", "url": "hive-sre/", "name": "hive-sre Help" }</script><!-- End Schema.org --> <!-- Mermaid light/dark themes -->  <link rel="stylesheet" type="text/css" href="mermaid.css">  </head>     <body data-id="hive-sre-sre" data-main-title="SRE Application (sre)" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="hive-sre.md|Introduction///hive-sre-Sub-Commands.md|Sub-Commands"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>hive-sre  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="hive-sre-sre"  id="hive-sre-sre.md"  >SRE Application (sre)</h1>  <p id="c006d372_11784">The <code class="code" id="c006d372_11785">sre</code> sub-command is used to find potential 'Hive' performance issues caused by small files and excessive partitions.</p><p id="c006d372_11786">The Sre Tool brings together information from the HMS RDBMS and HDFS to provide reports and potential actions to address areas of concern. This process is a READ-ONLY process and does not perform any actions automatically.</p><p id="c006d372_11787">Action commands for identified scenarios are written out to file(s), which can be reviewed / edited and run through either &quot;beeline&quot; for &quot;hive&quot; actions or in <a href="https://github.com/dstreev/hadoop-cli" id="c006d372_11788"   data-external="true" rel="noopener noreferrer" >Hadoop-CLI</a> for hdfs commands.</p><p id="c006d372_11789">This process is driven by a control file. A template is <a href="default-hive-sre-cfg.html" id="c006d372_11790" data-tooltip="Default Config Template # Required to connect to Metastore RDBMS. RDBMS driver needs to be included in the classpath metastore_direct: uri: &quot;FULL_RDMBS_URL_FOR_METASTORE_INCLUDING_THE_DB_NAME&quot; type: MYSQL | POSTGRES | ORACLE # Needed for Oracle Connections to pick the&hellip;"  >here</a>. Make a copy, edit the needed parameters and reference it with the '-cfg' parameter when running the process.</p><section class="chapter"><h2 id="known-issues" data-toc="known-issues">Known Issues</h2><p id="c006d372_11791">For a while during the evolution of Hive 3, there was a separate 'catalog' for Spark. The queries in this process do NOT consider this alternate catalog and may yield cross products in some areas if the 'spark' catalog was used at any point. Due to the nature of this tool and an attempt to use it across multiple versions of Hive, we do NOT include criteria regarding the 'catalog'.</p></section><section class="chapter"><h2 id="assumptions" data-toc="assumptions">Assumptions</h2><ul class="list _ul" id="c006d372_11792"    ><li class="list__item" id="c006d372_11793"><p>Ran from a node on the cluster </p><ul class="list _ul" id="c006d372_11794"    ><li class="list__item" id="c006d372_11795"><p>That includes clients and configuration files for HDFS</p></li></ul></li><li class="list__item" id="c006d372_11796"><p>Ran by a user that has READ privileges to all HDFS directories.</p></li><li class="list__item" id="c006d372_11797"><p>If cluster is 'kerberized', the user has a valid Kerberos Ticket 'before' starting the application.</p></li><li class="list__item" id="c006d372_11798"><p>Drivers for the HMS database are available.</p></li><li class="list__item" id="c006d372_11799"><p>The configuration file has been defined</p></li><li class="list__item" id="c006d372_11800"><p>The HMS Metastore DB is on a supported RDBMS for the platform (version matters!)</p></li></ul></section><section class="chapter"><h2 id="application-help" data-toc="application-help">Application Help</h2><div class="code-block" data-lang="none"         >
Launching: sre
usage: hive-sre u3|sre|perf -cdh|-hdp2|-hdp3|-all|-i &lt;proc[,proc...]&gt; -o &lt;output-dir&gt; [options]
                version:2.4.0.24.0-SNAPSHOT
Hive SRE Utility
 -all,--all-reports                            Run ALL available processes.
 -cdh,--cloudera-data-hub                      Run processes that make sense for CDH.
 -cfg,--config &lt;arg&gt;                           Config with details for the Sre Job.  Must match the
                                               either sre or u3 selection. Default:
                                               $HOME/.hive-sre/cfg/default.yaml
 -db,--database &lt;arg&gt;                          Comma separated list of Databases.  Will override
                                               config. (upto 100)
 -dbRegEx,--database-regex &lt;arg&gt;               A RegEx of databases to process
 -dp,--decrypt-password &lt;encrypted-password&gt;   Used this in conjunction with '-pkey' to decrypt the
                                               generated passcode from `-p`.
 -edbRegEx,--exclude-database-regex &lt;arg&gt;      A RegEx that will filter OUT matching databases from
                                               processing
 -h,--help                                     Help
 -hdp2,--hortonworks-data-platfrom-v2          Run processes that make sense for HDP2.
 -hdp3,--hortonworks-data-platfrom-v3          Run processes that make sense for HDP3.
 -hfw,--hive-framework &lt;arg&gt;                   The custom HiveFramework check configuration. Needs
                                               to be in the 'Classpath'.
 -i,--include &lt;arg&gt;                            Comma separated list of process id's to run.  When
                                               not specified, ALL processes are run.
 -o,--output-dir &lt;arg&gt;                         Output Directory to save results from Sre.
 -p,--password &lt;password&gt;                      Used this in conjunction with '-pkey' to generate the
                                               encrypted password that you'll add to the configs for
                                               the JDBC connections.
 -pkey,--password-key &lt;password-key&gt;           The key used to encrypt / decrypt the cluster jdbc
                                               passwords.  If not present, the passwords will be
                                               processed as is (clear text) from the config file.
 -scc,--skip-command-checks                    Don't process the command checks for the process.
 -tsql,--test-sql                              Check SQL against target Metastore RDBMS

Visit https://github.com/cloudera-labs/hive-sre for detailed docs
</div><p id="c006d372_11802">The <code class="code" id="c006d372_11803">-db</code> parameter is optional. When specified, it will limit the search to the databases listed as a parameter. IE: <code class="code" id="c006d372_11804">-db my_db,test_db</code></p><p id="c006d372_11805">The <code class="code" id="c006d372_11806">-o</code> parameter is <span class="emphasis" id="c006d372_11807">required</span>.</p><p id="c006d372_11808">To limit which process runs, use the <code class="code" id="c006d372_11809">-i</code> (include) option at the command line with a comma separated list of ids (below) of desired processes.</p></section><section class="chapter"><h2 id="sre-processes" data-toc="sre-processes">sre Processes</h2><div class="table-wrapper" ><table class="wide" id="c006d372_11810"  ><thead><tr class="ijRowHead" id="c006d372_11811"><th id="c006d372_11812"><p>id (link to sample report)</p></th><th id="c006d372_11813"><p>process</p></th></tr></thead><tbody ><tr id="c006d372_11814"><td id="c006d372_11815"><p><a href="hive-sre-sre-hms-report-detail.html" id="c006d372_11816" data-tooltip="Results empty"  >1</a></p></td><td id="c006d372_11817"><p>Hive Metastore Summary</p><br><p> - Numerous HMS reports outlining summary information about databases and tables</p></td></tr><tr id="c006d372_11819"><td id="c006d372_11820"><p><a href="hive-sre-sre-hms-report-detail.html" id="c006d372_11821" data-tooltip="Results empty"  >2</a></p></td><td id="c006d372_11822"><p>Hive Metastore Details</p><br><p> - Numerous HMS reports outlining detailed information about databases and tables</p></td></tr><tr id="c006d372_11824"><td id="c006d372_11825"><p><a href="hive-sre-sre-small-files.html" id="c006d372_11826" data-tooltip="truncated for brevity"  >3</a></p></td><td id="c006d372_11827"><p>Table and Partition Scan - Small Files</p></td></tr><tr id="c006d372_11828"><td id="c006d372_11829"><p><a href="hive-sre-sre-table-volume.html" id="c006d372_11830" data-tooltip="truncated for brevity"  >4</a></p></td><td id="c006d372_11831"><p>Table and Partition Scan - Volume Report</p></td></tr><tr id="c006d372_11832"><td id="c006d372_11833"><p><a href="hive-sre-sre-empty-datasets.html" id="c006d372_11834" data-tooltip="Empty Datasets DatabaseTableTypePartitionPath credit_cardcc_transMANAGED_TABLE hdfs://HOME90/warehouse/tablespace/managed/hive/credit_card.db/cc_trans credit_cardcc_trans_streamMANAGED_TABLE hdfs://HOME90/warehouse/tablespace/managed/hive/credit_card.db/cc_trans_stream&hellip;"  >5</a></p></td><td id="c006d372_11835"><p>Table and Partition Scan - Empty Datasets</p></td></tr><tr id="c006d372_11836"><td id="c006d372_11837"><p><a href="hive-sre-u3-managed-compactions.html" id="c006d372_11838" data-tooltip="Managed Compactions -- Hive 3 - Compaction Check ALTER TABLE covid_ga.county_cases_archive PARTITION (year_month=&quot;RUN_1&quot;) COMPACT &quot;MAJOR&quot;; ALTER TABLE covid_ga.county_cases_archive PARTITION (year_month=&quot;2020-08&quot;) COMPACT &quot;MAJOR&quot;; ALTER TABLE&hellip;"  >6</a></p></td><td id="c006d372_11839"><p>Table and Partition Compactions</p></td></tr><tr id="c006d372_11840"><td id="c006d372_11841"><p><a href="hive-sre-sre-acid-analyze-tables.html" id="c006d372_11842" data-tooltip="Post Upgrade from Hive 1/2 to Hive 3 may result in statistics that are wrong. Actually, the statistics were wrong in Hive 1/2, but the CBO wasn't using them as it should and recalculating plans. In Hive 3, these statistics when wrong and picked up by the CBO, could cause datasets to&hellip;"  >8</a></p></td><td id="c006d372_11843"><p>Analyze Tables (beta - use <code class="code" id="c006d372_11844">-i 8</code> to activate)</p></td></tr><tr id="c006d372_11845"><td id="c006d372_11846"><p><a href="hive-sre-sre-acid-analyze-tables-detailed.html" id="c006d372_11847" data-tooltip="Post Upgrade from Hive 1/2 to Hive 3 may result in statistics that are wrong. Actually, the statistics were wrong in Hive 1/2, but the CBO wasn't using them as it should and recalculating plans. In Hive 3, these statistics when wrong and picked up by the CBO, could cause datasets to&hellip;"  >9</a></p></td><td id="c006d372_11848"><p>Analyze Tables - Detailed (beta - use <code class="code" id="c006d372_11849">-i 9</code> to activate)</p></td></tr><tr id="c006d372_11850"><td id="c006d372_11851"><p><a href="hive-sre-sre-hive-tbl-unique-base-dir-count.html" id="c006d372_11852" data-tooltip="This report will show which databases have more than 1 base directory per table type."  >10</a></p></td><td id="c006d372_11853"><p>Hive Table Type Base Location UNIQUE Count</p></td></tr><tr id="c006d372_11854"><td id="c006d372_11855"><p><a href="hive-sre-sre-hive-tbl-anti-pattern-base-dir-count.html" id="c006d372_11856" data-tooltip="This report will show the unique base directories for table type in a database with an instance count for each. This should give you a good idea on the scope of the deviation. If there is only a single base directory for a table in a database (regardless of count), then the table&hellip;"  >11</a></p></td><td id="c006d372_11857"><p>Hive Table Type Base Location Count Detail - Anti Pattern</p></td></tr></tbody ></table ></div><p id="c006d372_11858">Sre needs to be run by a user with READ access to all the potential HDFS locations presented by the database/table/partition defined locations.</p></section><div class="last-modified"> Last modified: 07 November 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="hive-sre-u3e-procs.html">Procedures</a>   <a class="navigation-links__next" href="hive-sre-perf.html">Hive JDBC Performance Testing Tool (perf)</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.1.5-b176/app.js"></script></body></html>