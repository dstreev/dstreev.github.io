<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-11-07T08:04:35.889445"><meta name="build-number" content="${buildNumber}">       <title>Upgrading to CDP | hive-sre</title><script id="virtual-toc-data" type="application/json">[{"id":"conversion-matrix","level":0,"title":"Conversion Matrix","anchor":"#conversion-matrix"},{"id":"general-recommendation","level":0,"title":"General Recommendation","anchor":"#general-recommendation"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.1.5-b176/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Upgrading to CDP | hive-sre"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="hive-sre Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="hive-sreto-cdp.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Upgrading to CDP | hive-sre"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "hive-sreto-cdp.html#webpage", "url": "hive-sreto-cdp.html", "name": "Upgrading to CDP | hive-sre", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "hive-sre/#website", "url": "hive-sre/", "name": "hive-sre Help" }</script><!-- End Schema.org --> <!-- Mermaid light/dark themes -->  <link rel="stylesheet" type="text/css" href="mermaid.css">  </head>     <body data-id="to-cdp" data-main-title="Upgrading to CDP" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="hive-sre.md|Introduction///hive-sre-Sub-Commands.md|Sub-Commands///hive-sre-u3.md|Hive Upgrade Check (u3)"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>hive-sre  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="to-cdp"  id="to-cdp.md"  >Upgrading to CDP</h1>  <p id="97aed885_5010">CDP 7.x+ is running Hive 3. Platforms running Hive 1/2 (CDH 5/6 and HDP 2) need to upgrade/convert tables so they are compatible with Hive 3.</p><p id="97aed885_5011">The most significant adjustment is the definition of a &quot;Managed Table&quot;. In Hive 1/2, a managed table is defined as &quot;Drop the table, drop the data.&quot; In this state, a managed table will maintain the tables state in the 'metastore' AND the 'filesystem'. In Hive 3, a &quot;Managed Table&quot; has been elevated and is a transactional table (ACID).</p><p id="97aed885_5012">Review the table below for details on what 'should' be converted to what.</p><section class="chapter"><h2 id="conversion-matrix" data-toc="conversion-matrix">Conversion Matrix</h2><div class="table-wrapper" ><table class="wide" id="97aed885_5013"  ><thead><tr class="ijRowHead" id="97aed885_5014"><th id="97aed885_5015"><p>Legacy Table Type</p></th><th id="97aed885_5016"><p>New Table Type</p></th><th id="97aed885_5017"><p>CDH Recommendation</p></th><th id="97aed885_5018"><p>HDP Recommendation</p></th></tr></thead><tbody ><tr id="97aed885_5019"><td id="97aed885_5020"><p>External</p></td><td id="97aed885_5021"><p>External</p></td><td id="97aed885_5022"><p>External</p></td><td id="97aed885_5023"><p>External</p></td></tr><tr id="97aed885_5024"><td id="97aed885_5025"><p>Managed (non-transaction)</p></td><td id="97aed885_5026"><p>External / Purge</p></td><td id="97aed885_5027"><p>N/A</p></td><td id="97aed885_5028"><p>External / Purge <sup class="superscript" id="fnref-1"><a href="#fn-1" id="97aed885_5029" data-tooltip="CDP 7.x+ is running Hive 3. Platforms running Hive 1/2 (CDH 5/6 and HDP 2) need to upgrade/convert tables so they are compatible with Hive 3."  >1</a></sup></p></td></tr><tr id="97aed885_5030"><td id="97aed885_5031"><p>Managed (Transactional)</p></td><td id="97aed885_5032"><p>Managed (Transactional)</p></td><td id="97aed885_5033"><p>N/A</p></td><td id="97aed885_5034"><p>Managed (Transactional)</p></td></tr></tbody ></table ></div></section><section class="chapter"><h2 id="general-recommendation" data-toc="general-recommendation">General Recommendation</h2><p id="97aed885_5035"><span class="control" id="97aed885_5036">Do NOT migrate &quot;Legacy Managed&quot; tables to &quot;Managed Transactional&quot; tables.</span> This is not meant to dissuade you away from using ACID/Transactional table in anyway. It has been our experience that ACID tables support certain access methods which isn't compatible</p><section class="chapter"><h3 id="for-cdh-5-and-6-and-hdp-2-clusters" data-toc="for-cdh-5-and-6-and-hdp-2-clusters">For CDH (5 and 6) and HDP 2 Clusters</h3><p id="97aed885_5037">The <a href="https://docs.cloudera.com/cdp-private-cloud/latest/upgrade-cdh/topics/ug_hive_validations.html" id="97aed885_5038"   data-external="true" rel="noopener noreferrer" >Cloudera upgrade documentation for CDH clusters</a> outlines a series of steps to reduce the downtime and hasten the 'Hive' upgrade process by skipping the detailed evaluation of 'every' table in the metastore. But, in contrast, the work STILL need to be done. The <code class="code" id="97aed885_5039">hive-sre</code> tool generates scripts (below) that make up for the things skipped.</p><p id="97aed885_5040">If you follow the CDP docs to 'expedite' the hive upgrade process, these steps can be done 'post' upgrade BEFORE you release the cluster to the community. Process <a href="hive-sre-u3-loc-scan-missing-dirs.html" id="97aed885_5041" data-tooltip="truncated for brevity..."  >1</a> (missing directories) can be done BEFORE the upgrade, and may even reduce the number of items captured in the other steps.</p><p id="97aed885_5042">Run the <a href="hive-sre-u3.html" id="97aed885_5043" data-tooltip="The u3 sub-command is a process that is used to review 'Hive 1/2' environments for Hive3 upgrade planning."  ><code class="code" id="97aed885_5044">u3</code></a> process against all your databases and <span class="control" id="97aed885_5045">act</span> upon the results from process ID's:</p><ul class="list _ul" id="97aed885_5046"    ><li class="list__item" id="97aed885_5047"><p><a href="hive-sre-u3-loc-scan-missing-dirs.html" id="97aed885_5048" data-tooltip="truncated for brevity..."  >1</a> - Missing Directories</p></li><li class="list__item" id="97aed885_5049"><p><a href="hive-sre-u3-managed-upgrade-2-acid.html" id="97aed885_5050" data-tooltip="Managed Upgrade 2 ACID Hive 3 Upgrade Checks - Managed Non-ACID to ACID Table Migrations -- Table is owned by 'dstreev', not 'hive', and NOT currently ACID. -- This table 'could' be migrated to an ACID table unless changed. -- Recommend forcing the manual conversion to ensure table&hellip;"  >3</a> - Managed Table Conversions</p></li><li class="list__item" id="97aed885_5051"><p><a href="hive-sre-u3-hms-checks.html" id="97aed885_5052" data-tooltip="Listed tables should be review to ensure the Serde is still available. Missing Serde's can disrupt a Hive Upgrade/Migration Process"  >5</a> - Kudu, Serdes, Decimal scale/precision issues</p></li></ul></section></section><div class="last-modified"> Last modified: 07 November 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="hive-sre-u3-procs.html">Checks and Validations Processes</a>   <a class="navigation-links__next" href="u3e.html">Hive 3 Upgrade Execution Process (u3e)</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.1.5-b176/app.js"></script></body></html>