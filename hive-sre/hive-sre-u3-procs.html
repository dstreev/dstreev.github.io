<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-11-06T15:26:13.629499"><meta name="build-number" content="${buildNumber}">       <title>Checks and Validations Processes | hive-sre</title><script id="virtual-toc-data" type="application/json">[{"id":"1-hive-3-upgrade-checks-locations-scan","level":0,"title":"1. Hive 3 Upgrade Checks - Locations Scan","anchor":"#1-hive-3-upgrade-checks-locations-scan"},{"id":"2-hive-3-upgrade-checks-bad-orc-filenames","level":0,"title":"2. Hive 3 Upgrade Checks - Bad ORC Filenames","anchor":"#2-hive-3-upgrade-checks-bad-orc-filenames"},{"id":"3-hive-3-upgrade-checks-managed-table-migrations","level":0,"title":"3. Hive 3 Upgrade Checks - Managed Table Migrations","anchor":"#3-hive-3-upgrade-checks-managed-table-migrations"},{"id":"4-hive-3-upgrade-checks-compaction-check","level":0,"title":"4. Hive 3 Upgrade Checks - Compaction Check","anchor":"#4-hive-3-upgrade-checks-compaction-check"},{"id":"5-metastore-report","level":0,"title":"5. Metastore Report","anchor":"#5-metastore-report"},{"id":"6-hive-acid-tables-missing-bucketing-version-2-tblproperties","level":0,"title":"6. Hive ACID tables missing \u0027bucketing_version\u0027\u003d\u00272\u0027 tblproperties","anchor":"#6-hive-acid-tables-missing-bucketing-version-2-tblproperties"},{"id":"7-hive-storage-handlers","level":0,"title":"7. Hive Storage Handlers","anchor":"#7-hive-storage-handlers"},{"id":"8-legacy-managed-non-transactional-non-acid-conversions-to-external-purge","level":0,"title":"8. Legacy Managed Non-Transactional (non-acid) Conversions to EXTERNAL/PURGE","anchor":"#8-legacy-managed-non-transactional-non-acid-conversions-to-external-purge"},{"id":"9-hive-acid-tables-missing-bucketing-version-2-tblproperties","level":0,"title":"9. Hive ACID tables missing \u0027bucketing_version\u0027\u003d\u00272\u0027 tblproperties","anchor":"#9-hive-acid-tables-missing-bucketing-version-2-tblproperties"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.1.5-b176/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Checks and Validations Processes | hive-sre"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="hive-sre Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="hive-srehive-sre-u3-procs.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Checks and Validations Processes | hive-sre"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "hive-srehive-sre-u3-procs.html#webpage", "url": "hive-srehive-sre-u3-procs.html", "name": "Checks and Validations Processes | hive-sre", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "hive-sre/#website", "url": "hive-sre/", "name": "hive-sre Help" }</script><!-- End Schema.org --> <!-- Mermaid light/dark themes -->  <link rel="stylesheet" type="text/css" href="mermaid.css">  </head>     <body data-id="hive-sre-u3-procs" data-main-title="Checks and Validations Processes" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="hive-sre.md|Introduction///hive-sre-Sub-Commands.md|Sub-Commands///hive-sre-u3.md|Hive Upgrade Check (u3)"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>hive-sre  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="hive-sre-u3-procs"  id="hive-sre-u3-procs.md"  >Checks and Validations Processes</h1>  <p id="bea46736_4326"><code class="code" id="bea46736_4327">hive-sre</code> has the following checks and validations. Use one of <code class="code" id="bea46736_4328">-hdp2</code>, <code class="code" id="bea46736_4329">-hdp3</code>, <code class="code" id="bea46736_4330">-cdh</code>, <code class="code" id="bea46736_4331">-all</code>, or <code class="code" id="bea46736_4332">-i &lt;process_ids&gt;</code> to run the checks.</p><p id="bea46736_4333">Below is the list of checks and validations. The process ID is the indexed number below, if you wish to run with the <code class="code" id="bea46736_4334">-i</code> option.</p><section class="chapter"><h2 id="1-hive-3-upgrade-checks-locations-scan" data-toc="1-hive-3-upgrade-checks-locations-scan">1. Hive 3 Upgrade Checks - Locations Scan</h2><div class="code-block" data-lang="none"         >- Missing Directories
</div><aside class="prompt" data-type="tip" data-title="" id="bea46736_4336"><p id="bea46736_4337">Missing Directories cause the upgrade conversion process to fail. To prevent that failure, there are two choices for a 'missing directory'. Either create it of drop the table/partition.</p></aside><div class="code-block" data-lang="none"         >- You have two choices based on the output of this process.
    - RECOMMENDED: Drop the table/partition OR
    - Create the missing directory referenced by the table/partition (empty directories have been known to cause hive table CBO issues, leading to performance slowdowns).
- The output file from this process will provide commands to accomplish which ever direction you choose. Use 'hive' to run the sql statements.  Use [hadoopcli](https://github.com/dstreev/hadoop-cli) to run the 'hdfs' commands in bulk.
</div></section><section class="chapter"><h2 id="2-hive-3-upgrade-checks-bad-orc-filenames" data-toc="2-hive-3-upgrade-checks-bad-orc-filenames">2. Hive 3 Upgrade Checks - Bad ORC Filenames</h2><div class="code-block" data-lang="none"         >- Bad Filename Format
</div><aside class="prompt" data-type="tip" data-title="" id="bea46736_4340"><p id="bea46736_4341">Tables that would be convert from a Managed Non-Acid table to an ACID transactional table require the files to match a certain pattern. This process will scan the potential directories of these tables for bad filename patterns. When located, it will indicate which tables/partitions have been file naming conventions that would prevent a successful conversion to ACID. The best and easiest way to correct these files names is to use HiveSQL to rewrite the contents of the table/partition with a simple 'INSERT OVERWRITE TABLE xxx SELECT * FROM xxx'. This type of statement will replace the current bad filenames with valid file names by rewriting the contents in HiveSQL.</p></aside></section><section class="chapter"><h2 id="3-hive-3-upgrade-checks-managed-table-migrations" data-toc="3-hive-3-upgrade-checks-managed-table-migrations">3. Hive 3 Upgrade Checks - Managed Table Migrations</h2><div class="code-block" data-lang="none"         >- Ownership Check
- Conversion to ACID tables
</div><aside class="prompt" data-type="tip" data-title="" id="bea46736_4343"><p id="bea46736_4344">This process will list tables that will and 'could' be migrated to &quot;Managed ACID&quot; tables during the upgrade process. If these tables are used by Spark OR data is managed by a separate process that interacts with the FileSystem, DO NOT LET THESE conversion happen. The output of this process will supply Hive DDL commands to convert these tables to &quot;EXTERNAL / PURGE&quot; tables in Hive 3, which is the same as the 'classic' Hive 1/2 Managed Non-Acid table.</p></aside></section><section class="chapter"><h2 id="4-hive-3-upgrade-checks-compaction-check" data-toc="4-hive-3-upgrade-checks-compaction-check">4. Hive 3 Upgrade Checks - Compaction Check</h2><div class="code-block" data-lang="none"         >- Compaction Check
</div><aside class="prompt" data-type="tip" data-title="" id="bea46736_4346"><p id="bea46736_4347">Review ACID tables for 'delta' directories. Where 'delta' directories are found, we'll</p></aside></section><section class="chapter"><h2 id="5-metastore-report" data-toc="5-metastore-report">5. Metastore Report</h2><div class="code-block" data-lang="none"         >- Questionable Serde's Check
</div><aside class="prompt" data-type="tip" data-title="" id="bea46736_4349"><p id="bea46736_4350">Will list tables using SERDE's that are not standard to the platform. - Action here either: - Remove the table using the SERDE, if the SERDE isn't available - Ensure the SERDE is available during the upgrade so table can be evaluated. - Legacy Kudu Serde Report &gt; Early versions of Hive/Impala tables using Kudu were built before Kudu became an Apache Project. Once it became an Apache Project, the base Kudu Storage Handler classname changed. This report locates and reports on tables using the legacy storage handler class. - Legacy Decimal Scale and Precision Check &gt; When the <code class="code" id="bea46736_4351">DECIMAL</code> data type was first introduced in Hive 1, it did NOT include a Scale or Precision element. This causes issues in later integration with Hive and Spark. We'll identify and suggest corrective action for tables where this condition exists. - Managed Table Shadows In Hive 3, Managed tables are 'ACID' tables. Sharing a location between two 'ACID' tables will cause compaction issues and data issues. These need to be resolved before the upgrade. - Database / Table and Partition Counts Use this to understand the scope of what is in the metastore.</p></aside></section><section class="chapter"><h2 id="6-hive-acid-tables-missing-bucketing-version-2-tblproperties" data-toc="6-hive-acid-tables-missing-bucketing-version-2-tblproperties">6. Hive ACID tables missing 'bucketing_version'='2' tblproperties</h2><ul class="list _ul" id="bea46736_4352"    ><li class="list__item" id="bea46736_4353"><p>This report will show the ACID tables that don't contain the required 'bucketing_version=2' tblproperties configuration. This is required for the upgrade to Hive 3. -- Without this setting, you will have issues access/reading/processing the upgraded ACID table. -- We recommend that you run the script to add this configuration value to the tables.</p></li></ul></section><section class="chapter"><h2 id="7-hive-storage-handlers" data-toc="7-hive-storage-handlers">7. Hive Storage Handlers</h2><p id="bea46736_4354">If any of these storage handlers show up as a 'MANAGED_TABLE' type and you are upgrading from a legacy (Hive 1/2) platform, the 'Managed Non-ACID to ACID Table Migrations' process will pick them up for conversion. If the storage handlers location information is NOT valid or the Hive table is orphaned, the upgrade will fail while attempting to convert the table and affect your ability to complete the upgrade process for Hive.\n\n Ensure the location for 'MANAGED_TABLE' Storage Handler backed tables is valid AND available.</p></section><section class="chapter"><h2 id="8-legacy-managed-non-transactional-non-acid-conversions-to-external-purge" data-toc="8-legacy-managed-non-transactional-non-acid-conversions-to-external-purge">8. Legacy Managed Non-Transactional (non-acid) Conversions to EXTERNAL/PURGE</h2><p id="bea46736_4355">This is a list of tables that meet the LEGACY Managed non-transactional criteria. Use this to understand the scope of the change.</p><p id="bea46736_4356">Run the <code class="code" id="bea46736_4357">u3e</code> process to execute the fixes for this list of tables.</p></section><section class="chapter"><h2 id="9-hive-acid-tables-missing-bucketing-version-2-tblproperties" data-toc="9-hive-acid-tables-missing-bucketing-version-2-tblproperties">9. Hive ACID tables missing 'bucketing_version'='2' tblproperties</h2><p id="bea46736_4358">This report will show the ACID tables that don't contain the required 'bucketing_version=2' tblproperties configuration. Without this setting, you will have issues access/reading/processing the upgraded ACID table.</p><p id="bea46736_4359">We recommend that you run the <code class="code" id="bea46736_4360">u3e</code> process to correct after the upgrade.</p></section><div class="last-modified"> Last modified: 06 November 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="hive-sre-u3.html">Hive Upgrade Check (u3)</a>   <a class="navigation-links__next" href="to-cdp.html">Upgrading to CDP</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.1.5-b176/app.js"></script></body></html>